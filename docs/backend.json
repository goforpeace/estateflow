
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the EstateFlow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "role": {
          "type": "string",
          "description": "User's role (Admin, Accountant, Viewer)."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a real estate project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project entity."
        },
        "projectName": {
          "type": "string",
          "description": "Name of the project."
        },
        "location": {
          "type": "string",
          "description": "Location of the project."
        },
        "totalFlats": {
          "type": "number",
          "description": "Total number of flats in the project."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the project.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the project (Planning, Ongoing, Completed)."
        },
        "targetSell": {
          "type": "number",
          "description": "Target sell amount for the project."
        }
      },
      "required": [
        "id",
        "projectName",
        "location",
        "totalFlats",
        "startDate",
        "status",
        "targetSell"
      ]
    },
    "Flat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Flat",
      "type": "object",
      "description": "Represents a flat within a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the flat entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Flat)"
        },
        "flatNumber": {
          "type": "string",
          "description": "Flat number."
        },
        "ownership": {
          "type": "string",
          "description": "Ownership of the flat (Developer, Landowner)."
        },
        "salePrice": {
          "type": "number",
          "description": "Sale price of the flat (only for developer flats)."
        },
        "status": {
          "type": "string",
          "description": "Status of the flat (Available, Sold, Reserved)."
        },
        "flatSize": {
          "type": "number",
          "description": "Size of the flat in square feet."
        }
      },
      "required": [
        "id",
        "projectId",
        "flatNumber",
        "ownership",
        "status",
        "flatSize"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer entity."
        },
        "fullName": {
          "type": "string",
          "description": "Customer's full name."
        },
        "mobile": {
          "type": "string",
          "description": "Customer's mobile phone number."
        },
        "address": {
          "type": "string",
          "description": "Customer's address."
        },
        "nidNumber": {
          "type": "string",
          "description": "Customer's National ID number."
        }
      },
      "required": [
        "id",
        "fullName",
        "mobile",
        "address",
        "nidNumber"
      ]
    },
    "Vendor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vendor",
      "type": "object",
      "description": "Represents a supplier or service provider.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vendor entity."
        },
        "vendorName": {
          "type": "string",
          "description": "The name of the vendor."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The vendor's contact phone number."
        },
        "enterpriseName": {
          "type": "string",
          "description": "The name of the vendor's company or enterprise."
        },
        "details": {
          "type": "string",
          "description": "Additional details or notes about the vendor."
        }
      },
      "required": [
        "id",
        "vendorName",
        "phoneNumber",
        "enterpriseName"
      ]
    },
    "InflowTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InflowTransaction",
      "type": "object",
      "description": "Represents a cash inflow transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inflow transaction entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N InflowTransaction)"
        },
        "flatId": {
          "type": "string",
          "description": "Reference to Flat. (Relationship: Flat 1:N InflowTransaction)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N InflowTransaction)"
        },
        "paymentType": {
          "type": "string",
          "description": "Type of payment (Booking, Installment)."
        },
        "date": {
          "type": "string",
          "description": "Date of the inflow transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the inflow transaction."
        },
        "paymentMethod": {
            "type": "string",
            "description": "Method of payment (Cash, Cheque, Bank Transfer)."
        },
        "receiptId": {
            "type": "string",
            "description": "Unique identifier for the receipt."
        },
        "reference": {
            "type": "string",
            "description": "Reference information for the transaction."
        }
      },
      "required": [
        "id",
        "projectId",
        "flatId",
        "customerId",
        "paymentType",
        "date",
        "amount",
        "paymentMethod"
      ]
    },
    "OutflowTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OutflowTransaction",
      "type": "object",
      "description": "Represents a cash outflow transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the outflow transaction entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N OutflowTransaction). Can be null if it is an office cost."
        },
        "expenseCategory": {
          "type": "string",
          "description": "Category of the expense (Material, Labor, Utility, Office)."
        },
        "supplierVendor": {
          "type": "string",
          "description": "Supplier or vendor for the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the outflow transaction."
        },
        "date": {
          "type": "string",
          "description": "Date of the outflow transaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "expenseCategory",
        "supplierVendor",
        "amount",
        "date"
      ]
    },
    "OfficeExpense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OfficeExpense",
      "type": "object",
      "description": "Represents an office expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the office expense entity."
        },
        "expenseCategory": {
          "type": "string",
          "description": "Category of the expense (Rent, Salary)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the office expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the office expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "expenseCategory",
        "amount",
        "date"
      ]
    },
    "OfficeCostAllocation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OfficeCostAllocation",
      "type": "object",
      "description": "Represents the allocation of office costs to projects.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the office cost allocation entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N OfficeCostAllocation)"
        },
        "officeExpenseId": {
          "type": "string",
          "description": "Reference to OfficeExpense. (Relationship: OfficeExpense 1:N OfficeCostAllocation)"
        },
        "allocationAmount": {
          "type": "number",
          "description": "Amount of office cost allocated to the project."
        },
        "allocationMonth": {
          "type": "string",
          "description": "Month for which the office cost is allocated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "projectId",
        "officeExpenseId",
        "allocationAmount",
        "allocationMonth"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale of a flat.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale transaction."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project."
        },
        "flatId": {
          "type": "string",
          "description": "Reference to Flat."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer."
        },
        "totalPrice": {
          "type": "number",
          "description": "Total sale price of the flat."
        },
        "perSftPrice": {
          "type": "number",
          "description": "Price per square foot."
        },
        "parkingCharge": {
          "type": "number",
          "description": "Cost for parking."
        },
        "utilityCharge": {
          "type": "number",
          "description": "Cost for utilities."
        },
        "downpayment": {
          "type": "number",
          "description": "Initial downpayment amount."
        },
        "monthlyInstallment": {
          "type": "number",
          "description": "Amount for each monthly installment."
        },
        "saleDate": {
          "type": "string",
          "format": "date-time",
          "description": "Date of the sale."
        },
        "note": {
          "type": "string",
          "description": "Additional notes for the sale."
        },
        "deedLink": {
          "type": "string",
          "description": "Link to the uploaded deed document."
        },
        "extraCosts": {
            "type": "array",
            "description": "Additional costs for the sale.",
            "items": {
                "type": "object",
                "properties": {
                    "purpose": {
                        "type": "string"
                    },
                    "amount": {
                        "type": "number"
                    }
                },
                "required": ["purpose", "amount"]
            }
        }
      },
      "required": [
        "id",
        "projectId",
        "flatId",
        "customerId",
        "totalPrice",
        "saleDate"
      ]
    },
    "ExpenseItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExpenseItem",
      "type": "object",
      "description": "Represents a type of expense item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense item."
        },
        "name": {
          "type": "string",
          "description": "Name of the expense item (e.g., Cement, Labor, Steel)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a single expense transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense document."
        },
        "expenseId": {
          "type": "string",
          "description": "User-facing auto-generated identifier for the expense."
        },
        "vendorId": {
          "type": "string",
          "description": "Reference to the Vendor."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to the Project."
        },
        "itemId": {
          "type": "string",
          "description": "Reference to the ExpenseItem."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the item."
        },
        "price": {
          "type": "number",
          "description": "Price of the expense (outflow amount)."
        },
        "paidAmount": {
          "type": "number",
          "description": "The amount that has been paid for this expense."
        },
        "status": {
          "type": "string",
          "enum": ["Unpaid", "Partially Paid", "Paid"],
          "description": "The payment status of the expense."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "Date of the expense."
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        }
      },
      "required": [
        "id",
        "expenseId",
        "vendorId",
        "projectId",
        "itemId",
        "price",
        "date",
        "paidAmount",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Access is restricted to the user and administrators.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores project details.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/flats/{flatId}",
        "definition": {
          "entityName": "Flat",
          "schema": {
            "$ref": "#/backend/entities/Flat"
          },
          "description": "Stores flat information for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "flatId",
              "description": "The unique identifier for the flat."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/vendors/{vendorId}",
        "definition": {
          "entityName": "Vendor",
          "schema": {
            "$ref": "#/backend/entities/Vendor"
          },
          "description": "Stores vendor and supplier information.",
          "params": [
            {
              "name": "vendorId",
              "description": "The unique identifier for the vendor."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores flat sale transaction details.",
          "params": [
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/inflowTransactions/{inflowTransactionId}",
        "definition": {
          "entityName": "InflowTransaction",
          "schema": {
            "$ref": "#/backend/entities/InflowTransaction"
          },
          "description": "Stores inflow transactions for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "inflowTransactionId",
              "description": "The unique identifier for the inflow transaction."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/outflowTransactions/{outflowTransactionId}",
        "definition": {
          "entityName": "OutflowTransaction",
          "schema": {
            "$ref": "#/backend/entities/OutflowTransaction"
          },
          "description": "Stores outflow transactions for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "outflowTransactionId",
              "description": "The unique identifier for the outflow transaction."
            }
          ]
        }
      },
      {
        "path": "/officeExpenses/{officeExpenseId}",
        "definition": {
          "entityName": "OfficeExpense",
          "schema": {
            "$ref": "#/backend/entities/OfficeExpense"
          },
          "description": "Stores office expense information.",
          "params": [
            {
              "name": "officeExpenseId",
              "description": "The unique identifier for the office expense."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/officeCostAllocations/{officeCostAllocationId}",
        "definition": {
          "entityName": "OfficeCostAllocation",
          "schema": {
            "$ref": "#/backend/entities/OfficeCostAllocation"
          },
          "description": "Stores office cost allocation information for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "officeCostAllocationId",
              "description": "The unique identifier for the office cost allocation."
            }
          ]
        }
      },
      {
        "path": "/expenseItems/{expenseItemId}",
        "definition": {
          "entityName": "ExpenseItem",
          "schema": {
            "$ref": "#/backend/entities/ExpenseItem"
          },
          "description": "Stores the types of expense items that can be purchased.",
          "params": [
            {
              "name": "expenseItemId",
              "description": "The unique identifier for the expense item."
            }
          ]
        }
      },
      {
        "path": "/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores individual expense records.",
          "params": [
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure authorization independence, clarity, and scalability for the EstateFlow application. Key strategies include denormalization, structural segregation, and consistent access modeling.\n\n**Authorization Independence:**\nAuthorization independence is achieved by denormalizing authorization-related data. For instance, access to `flats` is determined by the project's attributes. If there were project-level access controls (e.g., project admins), this information would be denormalized into each flat document.\n\n**Structural Segregation:**\nData with different access requirements are stored in separate collections. User profiles are stored in `/users/{userId}`, ensuring that only the user (and admins) can access their data. Project-related data (flats, inflow transactions, outflow transactions, and office cost allocations) are organized under `/projects/{projectId}`, enabling project-level access control. Sales are stored in a top-level `/sales` collection for easier querying across all projects.\n\n**Access Modeling:**\n-   **User Data:** User profiles are stored under `/users/{userId}`, ensuring path-based ownership.\n-   **Project Data:** Project-related data is organized under `/projects/{projectId}`, with subcollections for flats, inflow transactions, outflow transactions and office cost allocations.\n-   **Sales Data:** Stored in a top-level `/sales` collection to allow for app-wide queries on sales data.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations by avoiding hierarchical authorization dependencies.  For example, listing flats within a project does not require fetching parent project data to validate access.\n\nIn summary, this structure promotes clear, maintainable security rules and supports the core features of the EstateFlow application while adhering to best practices for Firestore data modeling."
  }
}

    