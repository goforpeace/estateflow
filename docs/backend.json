{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the EstateFlow application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "role": {
          "type": "string",
          "description": "User's role (Admin, Accountant, Viewer)."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a real estate project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project entity."
        },
        "projectName": {
          "type": "string",
          "description": "Name of the project."
        },
        "location": {
          "type": "string",
          "description": "Location of the project."
        },
        "totalFlats": {
          "type": "number",
          "description": "Total number of flats in the project."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the project.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the project (Planning, Ongoing, Completed)."
        }
      },
      "required": [
        "id",
        "projectName",
        "location",
        "totalFlats",
        "startDate",
        "status"
      ]
    },
    "Flat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Flat",
      "type": "object",
      "description": "Represents a flat within a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the flat entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Flat)"
        },
        "flatNumber": {
          "type": "string",
          "description": "Flat number."
        },
        "ownership": {
          "type": "string",
          "description": "Ownership of the flat (Developer, Landowner)."
        },
        "salePrice": {
          "type": "number",
          "description": "Sale price of the flat (only for developer flats)."
        },
        "status": {
          "type": "string",
          "description": "Status of the flat (Available, Sold, Reserved)."
        },
        "flatSize": {
          "type": "number",
          "description": "Size of the flat in square feet."
        }
      },
      "required": [
        "id",
        "projectId",
        "flatNumber",
        "ownership",
        "status",
        "flatSize"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer entity."
        },
        "firstName": {
          "type": "string",
          "description": "Customer's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Customer's last name."
        },
        "email": {
          "type": "string",
          "description": "Customer's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Customer's phone number."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone"
      ]
    },
    "InflowTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InflowTransaction",
      "type": "object",
      "description": "Represents a cash inflow transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inflow transaction entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N InflowTransaction)"
        },
        "flatId": {
          "type": "string",
          "description": "Reference to Flat. (Relationship: Flat 1:N InflowTransaction)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N InflowTransaction)"
        },
        "paymentType": {
          "type": "string",
          "description": "Type of payment (Booking, Installment)."
        },
        "date": {
          "type": "string",
          "description": "Date of the inflow transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the inflow transaction."
        }
      },
      "required": [
        "id",
        "projectId",
        "flatId",
        "customerId",
        "paymentType",
        "date",
        "amount"
      ]
    },
    "OutflowTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OutflowTransaction",
      "type": "object",
      "description": "Represents a cash outflow transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the outflow transaction entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N OutflowTransaction). Can be null if it is an office cost."
        },
        "expenseCategory": {
          "type": "string",
          "description": "Category of the expense (Material, Labor, Utility, Office)."
        },
        "supplierVendor": {
          "type": "string",
          "description": "Supplier or vendor for the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the outflow transaction."
        },
        "date": {
          "type": "string",
          "description": "Date of the outflow transaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "expenseCategory",
        "supplierVendor",
        "amount",
        "date"
      ]
    },
    "OfficeExpense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OfficeExpense",
      "type": "object",
      "description": "Represents an office expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the office expense entity."
        },
        "expenseCategory": {
          "type": "string",
          "description": "Category of the expense (Rent, Salary)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the office expense."
        },
        "date": {
          "type": "string",
          "description": "Date of the office expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "expenseCategory",
        "amount",
        "date"
      ]
    },
    "OfficeCostAllocation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OfficeCostAllocation",
      "type": "object",
      "description": "Represents the allocation of office costs to projects.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the office cost allocation entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N OfficeCostAllocation)"
        },
        "officeExpenseId": {
          "type": "string",
          "description": "Reference to OfficeExpense. (Relationship: OfficeExpense 1:N OfficeCostAllocation)"
        },
        "allocationAmount": {
          "type": "number",
          "description": "Amount of office cost allocated to the project."
        },
        "allocationMonth": {
          "type": "string",
          "description": "Month for which the office cost is allocated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "projectId",
        "officeExpenseId",
        "allocationAmount",
        "allocationMonth"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Access is restricted to the user and administrators.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores project details.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/flats/{flatId}",
        "definition": {
          "entityName": "Flat",
          "schema": {
            "$ref": "#/backend/entities/Flat"
          },
          "description": "Stores flat information for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "flatId",
              "description": "The unique identifier for the flat."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/inflowTransactions/{inflowTransactionId}",
        "definition": {
          "entityName": "InflowTransaction",
          "schema": {
            "$ref": "#/backend/entities/InflowTransaction"
          },
          "description": "Stores inflow transactions for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "inflowTransactionId",
              "description": "The unique identifier for the inflow transaction."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/outflowTransactions/{outflowTransactionId}",
        "definition": {
          "entityName": "OutflowTransaction",
          "schema": {
            "$ref": "#/backend/entities/OutflowTransaction"
          },
          "description": "Stores outflow transactions for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "outflowTransactionId",
              "description": "The unique identifier for the outflow transaction."
            }
          ]
        }
      },
      {
        "path": "/officeExpenses/{officeExpenseId}",
        "definition": {
          "entityName": "OfficeExpense",
          "schema": {
            "$ref": "#/backend/entities/OfficeExpense"
          },
          "description": "Stores office expense information.",
          "params": [
            {
              "name": "officeExpenseId",
              "description": "The unique identifier for the office expense."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/officeCostAllocations/{officeCostAllocationId}",
        "definition": {
          "entityName": "OfficeCostAllocation",
          "schema": {
            "$ref": "#/backend/entities/OfficeCostAllocation"
          },
          "description": "Stores office cost allocation information for a specific project. Includes denormalized 'projectId' for efficient querying and security rules.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "officeCostAllocationId",
              "description": "The unique identifier for the office cost allocation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure authorization independence, clarity, and scalability for the EstateFlow application. Key strategies include denormalization, structural segregation, and consistent access modeling.\n\n**Authorization Independence:**\nAuthorization independence is achieved by denormalizing authorization-related data. For instance, access to `flats` is determined by the project's attributes. If there were project-level access controls (e.g., project admins), this information would be denormalized into each flat document.\n\n**Structural Segregation:**\nData with different access requirements are stored in separate collections. User profiles are stored in `/users/{userId}`, ensuring that only the user (and admins) can access their data. Project-related data (flats, inflow transactions, outflow transactions, and office cost allocations) are organized under `/projects/{projectId}`, enabling project-level access control.\n\n**Access Modeling:**\n-   **User Data:** User profiles are stored under `/users/{userId}`, ensuring path-based ownership.\n-   **Project Data:** Project-related data is organized under `/projects/{projectId}`, with subcollections for flats, inflow transactions, outflow transactions and office cost allocations.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations by avoiding hierarchical authorization dependencies.  For example, listing flats within a project does not require fetching parent project data to validate access.\n\nIn summary, this structure promotes clear, maintainable security rules and supports the core features of the EstateFlow application while adhering to best practices for Firestore data modeling."
  }
}